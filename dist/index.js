"use strict";function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var e=0;e<r.length;e++){var i=r[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,r,e){return r&&_defineProperties(t.prototype,r),e&&_defineProperties(t,e),t}Object.defineProperty(exports,"__esModule",{value:!0});var Node=function t(r,e){_classCallCheck(this,t),this.key=r,this.data=e,this.left=null,this.right=null,this.parent=null,this.cnt=0},SplayTree=function(){function f(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(t,r){return r<t?1:t<r?-1:0};_classCallCheck(this,f),this.comparator=r,this.duplicate=t,this._root=null,this._size=0}return _createClass(f,[{key:"update",value:function(t){t.cnt=1,t.left&&(t.cnt+=t.left.cnt),t.right&&(t.cnt+=t.right.cnt)}},{key:"rotate",value:function(t,r){var e=r.parent,i=null;return r===e.left?(e.left=i=r.right,r.right=e):(e.right=i=r.left,r.left=e),r.parent=e.parent,e.parent=r,i&&(i.parent=e),r.parent?e===r.parent.left?r.parent.left=r:r.parent.right=r:t=r,this.update(e),this.update(r),t}},{key:"splay",value:function(t,r){for(;r.parent;){var e=r.parent,i=e.parent;i&&this.rotate(t,r===e.left==(e===i.left)?e:r),t=this.rotate(t,r)}return t}},{key:"insert",value:function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=this._root,i=null;if(!e)return i=new Node(t,r),this._root=i,this._size++,i;for(;;){if(!this.duplicate&&0===this.comparator(t,e.key))return i;if(this.comparator(t,e.key)<0){if(!e.left){i=new Node(t,r),(e.left=i).parent=e,this._root=this.splay(this._root,i);break}e=e.left}else{if(!e.right){i=new Node(t,r),(e.right=i).parent=e,this._root=this.splay(this._root,i);break}e=e.right}}return this._size++,i}},{key:"merge",value:function(t){var r=this._root;if(!r&&!t.root)return null;if(!t.root)return r;if(!r)return this._root=t.root,this._size=t.size,this._root;for(;;)if(this.comparator(t.root.key,r.key)<0){if(!r.left){r.left=t.root,t.root.parent=r,this._root=this.splay(this._root,t.root);break}r=r.left}else{if(!r.right){r.right=t.root,t.root.parent=r,this._root=this.splay(this._root,t.root);break}r=r.right}return this._size+=t.size,t.root}},{key:"load",value:function(t,r){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:100,i=t.length;if(!r||i!==r.length){r=[];for(var o=0;o<i;o++)r.push({})}for(var n=i/e|0,s=[],h=0;h<e;h++){s.push(new f);for(var l=0;l<n;l++)s[h].insert(t[h*n+l],r[h*n+l]);this.merge(s[h])}for(var a=e*n;a<i;a++)this.insert(t[a],r[a])}},{key:"find",value:function(t){var r=this._root;if(!r)return!1;for(;r&&0!==this.comparator(t,r.key);)if(this.comparator(t,r.key)<0){if(!r.left)break;r=r.left}else{if(!r.right)break;r=r.right}return this._root=this.splay(this._root,r),0===this.comparator(t,r.key)}},{key:"findKth",value:function(t){if(t>=this._size)return!1;for(var r=this._root;;){for(;r.left&&r.left.cnt>t;)r=r.left;if(r.left&&(t-=r.left.cnt),!t--)break;r=r.right}return this._root=this.splay(this._root,r),!0}},{key:"remove",value:function(t){if(!this.find(t))return!1;var r=this._root;if(r.left){if(r.right){this._root=r.left,this._root.parent=null;for(var e=this._root;e.right;)e=e.right;return e.right=r.right,r.right.parent=e,!(r=null)}return this._root=r.left,!(r=this._root.parent=null)}return r.right?(this._root=r.right,!(r=this._root.parent=null)):(r=null,!(this._root=null))}},{key:"clear",value:function(){return this._root=null,this._size=0,this}},{key:"keys",value:function(){var t=[];return[function t(r,e){e.push(r.key),r.left&&t(r.left,e),r.right&&t(r.right,e)},function t(r,e){r.left&&t(r.left,e),e.push(r.key),r.right&&t(r.right,e)},function t(r,e){r.left&&t(r.left,e),r.right&&t(r.right,e),e.push(r.key)}][0<arguments.length&&void 0!==arguments[0]?arguments[0]:0](this._root,t),t}},{key:"root",get:function(){return this._root}},{key:"size",get:function(){return this._size}}]),f}();exports.SplayTree=SplayTree;
